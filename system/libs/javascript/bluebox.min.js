function bluebox(d,f,b,e){this.url=d;this.title=f;self.boxcount++;this.id=self.boxcount;if(b==null){var a=""}else{var a=" "+b}$("body").append('<div id="bluebox_'+self.boxcount+'" class="bluebox bluebox_wrapper '+a+'"><table class="bluebox_container windowzindex" cellspacing="0" cellpadding="0"><tr><td class="con_shadow" style="width: 16px;height: 16px;background-image: url(system/templates/css/images/tl.png);background-repeat: no-repeat;"></td><td class="con_shadow bluebox_border" style="height: 16px;background-repeat: repeat-x;"></td><td class="con_shadow" style="width: 16px;height: 16px;background-image: url(system/templates/css/images/tr.png);background-repeat: no-repeat;"></td></tr><tr><td class="con_shadow bluebox_border" style="width: 16px;background-repeat: repeat-y;"></td><td class="bluebox_inner"><div align="center" class="bluebox_loading"><img src="images/loading.gif" alt="loading..." /></div><div class="bluebox_data"><span class="bluebox_close" style="display: none;" onmouseover="this.style.color = \'#ffffff\';" onmouseout="this.style.color = \'#afafaf\';" onclick="getblueboxbyid($(this).parents(\'.bluebox_wrapper\').attr(\'id\').replace(\'bluebox_\',\'\')).close();">x</span><div class="bluebox_title"></div><div class="bluebox_content"></div><div class="bluebox_placeholder"></div></div></td><td class="con_shadow bluebox_border" style="width: 16px;background-repeat: repeat-y;"></td></tr><tr><td class="con_shadow" style="width: 16px;height: 16px;background-image: url(system/templates/css/images/bl.png);background-repeat: no-repeat;"></td><td class="con_shadow bluebox_border" style="height: 16px;background-repeat: repeat-x;"></td><td class="con_shadow" style="width: 16px;height: 16px;background-image: url(system/templates/css/images/br.png);background-repeat: no-repeat;"></td></tr></table></div>');$(".con_shadow").fadeTo("slow",0.7);this.div=document.getElementById("bluebox_"+self.boxcount);if(e!==false){var c=this;$(this.div).draggable({handle:".bluebox_title",start:function(){$(".windowzindex").parent().css("z-index",900);$(c.div).parent().css("z-index",901)}})}else{$(this.div).find(".bluebox_title").css("cursor","default")}this.id=self.boxcount;this.reset();this.removable=true;if(d!=null){this.load(d,f)}self.blueboxes[this.id]=this;return this}bluebox.prototype={reset:function(){var d=$(document).width();var c=d/2;var b=this.pagescroll();var e=b[1];var a=$(window).height();var e=e+a/6;$(this.div).css({top:e,left:c-56})},setTitle:function(a){this.title=a;if(a!=""){$(this.div).find(".bluebox_title").text(a)}else{$(this.div).find(".bluebox_title").html("&nbsp;")}},getTitle:function(){return this.title},load:function(a,e){this.setTitle(e);this.url=a;var c=this.div;$(c).find(".bluebox_loading").css("display","block");$(c).find(".bluebox_data").css("display","none");$(c).find(".bluebox_nav").css("display","none");var b=this;$(c).find(".bluebox_container").fadeIn("slow",function(){if(b.url.indexOf(" ")!=-1){urls=b.url.split(" ");var d=urls[0];var f=urls[1]}else{var d=b.url;var f=""}if(d.match(/^.*\.(img|png|jpg|gif|bmp)$/i)){b.player_image(d)}else{if(d.match(/^#.*$/)){b.player_html(d)}else{b.player_ajax(d,f)}}})},player_image:function(d){var b=d;var a=new Image();var c=this;a.onload=function(){var e=a.height;var g=a.width;var f=g/e;var i=$(window).height()-300;var h=$(window).width()-400;if(e>i){var e=i;var g=e*f}c.content('<div align="center"><img src="'+b+'" alt="'+b+'" height="'+e+'" width="'+g+'" /><br /></div>')};a.onerror=function(){c.content("<h3>Connection error!</h3> <br /> Please try again later!")};a.src=b},player_html:function(a){this.content($(a),true)},player_ajax:function(a,c){var b=this;$.ajax({method:"get",url:a,data:{boxid:this.id},error:function(e){var d=e.responseText;if(d!=null){var f=new RegExp("<body>");if(f.test(d)){var g=randomString(5);top[g+"_html"]=d;d='<iframe src="javascript:document.write(top.'+g+'_html);" height="500" width="100%" name="'+g+'" frameborder="0"></iframe>';if(c!=""){b.content(jQuery(d.replace(/<script(.|\s)*?\/script>/g,"")).find(c))}else{b.content(d)}}else{if(c!=""){b.content(jQuery(d.replace(/<script(.|\s)*?\/script>/g,"")).find(c))}else{b.content(d)}}}else{b.content("The request to the server wasn't complete.")}},success:function(d,f,e){LoadAjaxResources(e);var g=new RegExp("<body>");if(g.test(d)){var h=randomString(5);top[h+"_html"]=d;d='<iframe src="javascript:document.write(top.'+h+'_html);" height="500" width="100%" name="'+h+'" frameborder="0"></iframe>';if(c!=""){b.content(jQuery(d.replace(/<script(.|\s)*?\/script>/g,"")).find(c))}else{b.content(d)}}else{if(c!=""){b.content(jQuery(d.replace(/<script(.|\s)*?\/script>/g,"")).find(c))}else{b.content(d)}}}})},close:function(){$(this.div).find(".bluebox_container").fadeOut(300);if(this.removable){var a=this;setTimeout(function(){$(a.div).remove()},1000)}},content:function(c,b){var i=$(this.div);i.find(".bluebox_loading").css("display","block");i.find(".bluebox_data").css("display","none");if(b==null){i.find(".bluebox_content").html(c)}else{c.appendTo(i.find(".bluebox_content"));c.css("display","block")}i.find(".bluebox_close").css("display","block");i.find(".bluebox_data").css("display","block");var g=i.find(".bluebox_content").width();var h=i.find(".bluebox_content").height();i.find(".bluebox_data").css("display","none");var f=$(document).width();var a=f/2;var e=this;i.find(" > table").css("width","96");i.find(" > table").animate({width:g+32},150);i.animate({left:a-parseInt(g)/2+"px"},150);setTimeout(function(){e.hideLoading();$(e.div).find(".bluebox_data").css("display","block");$(e.div).find(".bluebox_data").css("height","64px");$(e.div).find(".bluebox_data").animate({height:h+14},200,function(){$(".bluebox_container").css("width","");$(e.div).find(".bluebox_data").css("height","")});$(".bluebox_container").css("width","")},160);setTimeout(function(){$(".bluebox_container").css("width","");$(".ui-resizable-handle").css("z-index",899)},400)},showLoading:function(){$(this.div).find(".bluebox_loading").css("display","block")},hideLoading:function(){$(this.div).find(".bluebox_loading").css("display","none")},pagescroll:function(){return new Array($(window).scrollLeft(),$(window).scrollTop())},hide:function(){$(this.div).find(".bluebox_container").fadeOut(300)}};var dialog=bluebox;